generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id               String           @id @default(cuid())
  email            String           @unique
  password         String?
  fullName         String
  userType         UserType
  phone            String?
  location         String?
  bio              String?
  emailVerified    DateTime?
  image            String?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  dateOfBirth      DateTime?
  ficaVerified     Boolean          @default(false)
  ficaVerifiedAt   DateTime?
  ficaVerifiedBy   String?
  idDocumentType   String?
  idDocumentUrl    String?
  idNumber         String?
  selfieUrl        String?
  paypalEmail      String?
  paypalVerified   Boolean          @default(false)
  paypalVerifiedAt DateTime?
  address          String?
  facebookUrl      String?
  instagramUrl     String?
  twitterUrl       String?
  documents        Document[]
  donations        Donation[]
  preferences      DonorPreference?
  requests         Request[]

  @@index([email])
  @@index([userType])
  @@index([ficaVerified])
}

model Request {
  id             String          @id @default(cuid())
  userId         String
  title          String
  description    String
  category       RequestCategory
  urgency        UrgencyLevel
  location       String
  targetAmount   Float?
  currentAmount  Float           @default(0)
  status         RequestStatus   @default(PENDING)
  verified       Boolean         @default(false)
  views          Int             @default(0)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  expiresAt      DateTime?
  featured       Boolean         @default(false)
  isAnonymous    Boolean         @default(false)
  customCategory String?
  documents      Document[]
  donations      Donation[]
  user           User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([category])
  @@index([status])
  @@index([urgency])
  @@index([location])
  @@index([createdAt])
  @@index([featured])
}

model Donation {
  id              String         @id @default(cuid())
  donorId         String
  requestId       String
  amount          Float
  message         String?
  status          DonationStatus @default(PLEDGED)
  anonymous       Boolean        @default(false)
  paymentIntentId String?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  paymentMethod   String?        @default("STRIPE")
  paymentStatus   String?        @default("PENDING")
  donor           User           @relation(fields: [donorId], references: [id], onDelete: Cascade)
  request         Request        @relation(fields: [requestId], references: [id], onDelete: Cascade)

  @@index([donorId])
  @@index([requestId])
  @@index([status])
  @@index([createdAt])
}

model Document {
  id              String         @id @default(cuid())
  userId          String
  requestId       String?
  fileName        String
  fileType        String
  fileSize        Int
  filePath        String
  documentType    String
  status          DocumentStatus @default(PENDING)
  rejectionReason String?
  uploadedAt      DateTime       @default(now())
  verifiedAt      DateTime?
  verifiedBy      String?
  request         Request?       @relation(fields: [requestId], references: [id], onDelete: Cascade)
  user            User           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([requestId])
  @@index([status])
}

model DonorPreference {
  id                  String            @id @default(cuid())
  userId              String            @unique
  preferredCategories RequestCategory[]
  preferredLocations  String[]
  minUrgency          UrgencyLevel?
  emailNotifications  Boolean           @default(true)
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  user                User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Notification {
  id        String   @id @default(cuid())
  userId    String
  title     String
  message   String
  type      String
  read      Boolean  @default(false)
  link      String?
  createdAt DateTime @default(now())

  @@index([userId])
  @@index([read])
  @@index([createdAt])
}

model BlogPost {
  id          String   @id @default(cuid())
  title       String
  slug        String   @unique
  excerpt     String
  content     String
  author      String
  category    String
  imageUrl    String?
  sourceUrl   String?
  isExternal  Boolean  @default(false)
  publishedAt DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([category])
  @@index([publishedAt(sort: Desc)])
  @@index([slug])
}

model Transaction {
  id              String            @id @default(cuid())
  type            TransactionType
  status          TransactionStatus @default(PENDING)
  amount          Float
  feeAmount       Float             @default(0)
  netAmount       Float
  currency        String            @default("ZAR")
  paymentGateway  String?
  paymentId       String?
  payerId         String?
  paymentIntentId String?
  gatewayResponse String?
  gatewayFee      Float?
  donorId         String?
  donorName       String?
  donorEmail      String?
  recipientId     String?
  recipientName   String?
  recipientEmail  String?
  requestId       String?
  requestTitle    String?
  approvedBy      String?
  approvedAt      DateTime?
  failureReason   String?
  adminNotes      String?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  completedAt     DateTime?

  @@index([type])
  @@index([status])
  @@index([donorId])
  @@index([recipientId])
  @@index([requestId])
  @@index([createdAt(sort: Desc)])
  @@index([paymentId])
}

model ContactMessage {
  id         String   @id @default(cuid())
  name       String
  email      String
  subject    String
  message    String
  status     String   @default("NEW")
  adminNotes String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([status])
  @@index([createdAt(sort: Desc)])
}

enum UserType {
  DONOR
  REQUESTER
  SPONSOR
  ADMIN
}

enum RequestCategory {
  FOOD
  RENT
  BILLS
  FAMILY_SUPPORT
  JOB_ASSISTANCE
  MEDICAL
  EDUCATION
  OTHER
  FOOD_GROCERIES
  RENT_HOUSING
  UTILITIES
  CLOTHING_ESSENTIALS
  TRANSPORTATION
  SINGLE_PARENTS
  CHILDCARE_SCHOOL
  NEWBORN_BABY
  ADOPTION_FOSTER
  FAMILY_EMERGENCY
  MEDICAL_BILLS
  PRESCRIPTION_MEDS
  DISABILITY_SUPPORT
  MENTAL_HEALTH
  THERAPY_REHAB
  TUITION_FEES
  BOOKS_SUPPLIES
  VOCATIONAL_TRAINING
  TECHNOLOGY_LEARNING
  RETIREMENT_SUPPORT
  MOBILITY_EQUIPMENT
  HOME_CARE
  SENIOR_SOCIAL_SUPPORT
  NATURAL_DISASTER
  ACCIDENT_INJURY
  DOMESTIC_VIOLENCE
  FUNERAL_SUPPORT
  LEGAL_AID_CRISIS
  NEIGHBORHOOD_PROJECT
  COMMUNITY_FOOD_DRIVE
  YOUTH_PROGRAMS
  CULTURAL_RELIGIOUS
  VOLUNTEER_NONPROFIT
  PET_FOOD_SUPPLIES
  EMERGENCY_VET_CARE
  ANIMAL_RESCUE
  FARM_ANIMAL_AID
  ADAPTIVE_EQUIPMENT
  HOME_MODIFICATIONS
  DISABLED_TRANSPORT
  SUPPORT_ANIMALS
  VETERAN_HOUSING
  PTSD_COUNSELING
  VETERAN_JOB_PLACEMENT
  VETERAN_FAMILY_AID
  STARTUP_GRANT
  BUSINESS_TOOLS
  BUSINESS_LICENSING
  BUSINESS_TRAINING
  EMERGENCY_SHELTER
  HOME_REPAIRS
  MOVING_ASSISTANCE
  EVICTION_PREVENTION
  RELOCATION_COSTS
  LEGAL_DOCUMENTATION
  LANGUAGE_INTEGRATION
  REFUGEE_EMERGENCY
  JOB_LOSS_HARDSHIP
  TRAVEL_EMERGENCY
  UNEXPECTED_EXPENSES
}

enum UrgencyLevel {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum RequestStatus {
  PENDING
  ACTIVE
  FUNDED
  PARTIALLY_FUNDED
  WITHDRAWN
  REJECTED
}

enum DonationStatus {
  PLEDGED
  COMPLETED
  REFUNDED
}

enum TransactionStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  REFUNDED
  CANCELLED
}

enum TransactionType {
  DONATION
  DISBURSEMENT
  REFUND
  FEE
}

enum DocumentStatus {
  PENDING
  VERIFIED
  REJECTED
}
